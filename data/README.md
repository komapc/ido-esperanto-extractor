# Unified Dictionary Data Format

This directory contains all dictionary data in a unified JSON format, enabling simple merging and regeneration of Apertium DIX files.

## Directory Structure

```
data/
├── sources/          # All source JSON files (unified format)
├── merged/           # Merged JSON files (gitignored - large)
├── generated/        # Generated DIX files (gitignored - large)
├── scripts/          # Data processing scripts
├── schema.json       # JSON schema for validation
└── README.md         # This file
```

## Unified Format

All source JSON files must conform to the schema defined in `schema.json`. The format is:

```json
{
  "metadata": {
    "source_name": "io_wiktionary",
    "version": "1.0",
    "generation_date": "2025-01-XX",
    "statistics": {...}
  },
  "entries": [
    {
      "lemma": "banko",
      "source": "io_wiktionary",
      "pos": "n",
      "morphology": {
        "paradigm": "o__n"
      },
      "translations": [
        {
          "term": "banko",
          "lang": "eo",
          "confidence": 1.0,
          "source": "io_wiktionary"
        }
      ],
      "metadata": {
        "source_page": "https://io.wiktionary.org/wiki/banko"
      }
    }
  ]
}
```

### Required Fields

- **lemma** (string, required): The Ido word form
- **source** (string, required): Source identifier (e.g., "io_wiktionary", "bert", "ido_lexicon")
- **translations** (array, required): List of translation objects (can be empty)
  - Each translation must have: `term`, `lang`, `confidence`, `source`

### Optional Fields

- **pos** (string): Part of speech
- **morphology** (object): Contains `paradigm` field
- **metadata** (object): Additional metadata like `source_page`

### Confidence Values

- **Wiktionary sources**: `1.0` (high confidence, curated data)
- **Wikipedia sources**: `0.9` (good confidence, less curated)
- **BERT alignment**: Actual similarity value from embedding alignment (0.0-1.0)
- **Lexicon**: `1.0` (manually curated)

## Source Files

All source files should be named `source_*.json` and placed in `sources/`:

- `source_io_wiktionary.json` - Ido Wiktionary entries
- `source_eo_wiktionary.json` - Esperanto Wiktionary entries
- `source_io_wikipedia.json` - Ido Wikipedia entries
- `source_bert_alignment.json` - BERT embedding alignment results
- `source_ido_lexicon.json` - Ido lexicon (migrated from YAML)

## Merging

The `merge_sources.py` script:
- Loads all `source_*.json` files from `sources/`
- Validates each against the schema (fails hard on mismatch)
- Merges all entries and translations (keeps ALL, no deduplication)
- Outputs to `merged/merged_bidix.json` and `merged_monodix.json`

## Regeneration

Run `regenerate_all.py` to:
1. Validate all source files
2. Merge all sources
3. Generate monodix (`generated/ido.ido.dix`)
4. Generate bidix (`generated/ido-epo.ido-epo.dix`)
5. Validate XML output

## Rules Preservation

Apertium rules (`.rlx`, `.t1x` files) are in `apertium/apertium-ido-epo/` and are **never modified** by regeneration. Only DIX files are generated.

## Validation

All source files must validate against `schema.json`. The regeneration script will:
- Validate each source file before merging
- Fail immediately on any schema mismatch
- Provide clear error messages indicating which file and field failed

## Git Ignore

Large generated files are gitignored:
- `merged/*.json` - Merged files (regenerated from sources)
- `generated/*.dix` - Generated DIX files (regenerated from merged JSON)
- `sources/*.json` - Source files (large, regenerated by extractors)

Example/template files can be kept with `.example` extension.

